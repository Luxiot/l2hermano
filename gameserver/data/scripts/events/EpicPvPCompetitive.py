# ===========================================
# PVP COMPETITIVO √âPICO - L2 HERMANOS
# ===========================================
# Sistema de PvP competitivo con monetizaci√≥n
# Competitive PvP system with monetization

import sys
from java.util import Calendar
from l2jfrozen.gameserver.model.quest import State
from l2jfrozen.gameserver.model.quest import QuestState
from l2jfrozen.gameserver.model.quest import Quest as JQuest
from l2jfrozen.gameserver.model.actor.instance import L2PcInstance
from l2jfrozen.gameserver.network.serverpackets import NpcHtmlMessage
from l2jfrozen.gameserver.network.serverpackets import SystemMessage
from l2jfrozen.gameserver.network.serverpackets import CreatureSay
from l2jfrozen.gameserver.GameServer import GameServer

class EpicPvPCompetitive(JQuest):
    def __init__(self, id, name, descr):
        JQuest.__init__(self, id, name, descr)
        self.pvpZones = {
            "COLISEO": {
                "name": "Coliseo √âpico",
                "description": "Arena de combate √©pica",
                "location": (149999, 46728, -3414),
                "cost": 0,
                "active": True
            },
            "RUINAS": {
                "name": "Ruinas √âpicas",
                "description": "Zona de combate en ruinas",
                "location": (186000, -10000, -3000),
                "cost": 1000,
                "active": True
            },
            "GIRAN_PVP": {
                "name": "Giran PvP Zone",
                "description": "Zona PvP en Giran",
                "location": (81304, 14589, -3469),
                "cost": 500,
                "active": True
            }
        }
        
        self.killStreaks = {
            5: {"name": "Killing Spree", "reward": 1000, "announce": True},
            10: {"name": "Rampage", "reward": 2500, "announce": True},
            15: {"name": "Unstoppable", "reward": 5000, "announce": True},
            20: {"name": "Dominating", "reward": 10000, "announce": True},
            25: {"name": "Legendary", "reward": 25000, "announce": True},
            30: {"name": "Godlike", "reward": 50000, "announce": True}
        }
        
        self.weeklyRanking = {}
        self.playerStats = {}
        
    def onAdvEvent(self, event, npc, player):
        if event == "mostrar_pvp_competitivo":
            return self.mostrarPvPCompetitivo(player)
        elif event.startswith("entrar_zona_"):
            zoneKey = event.replace("entrar_zona_", "")
            return self.entrarZonaPvP(player, zoneKey)
        elif event == "ver_ranking_semanal":
            return self.verRankingSemanal(player)
        elif event == "ver_mis_estadisticas":
            return self.verMisEstadisticas(player)
        elif event == "ver_kill_streaks":
            return self.verKillStreaks(player)
        elif event == "ver_recompensas_semanales":
            return self.verRecompensasSemanales(player)
        return None
    
    def mostrarPvPCompetitivo(self, player):
        html = "<html><body>"
        html += "<center><font color=\"LEVEL\">¬°¬°¬° PVP COMPETITIVO √âPICO DE L2 HERMANOS !!!</font></center><br>"
        html += "<center><font color=\"LEVEL\">¬°¬°¬° EPIC COMPETITIVE PVP OF L2 HERMANOS !!!</font></center><br><br>"
        
        html += "<font color=\"LEVEL\">‚öîÔ∏è ZONAS PVP DISPONIBLES / AVAILABLE PVP ZONES:</font><br><br>"
        
        for zoneKey, zoneInfo in self.pvpZones.items():
            status = "üü¢ ACTIVA" if zoneInfo["active"] else "üî¥ INACTIVA"
            statusEn = "üü¢ ACTIVE" if zoneInfo["active"] else "üî¥ INACTIVE"
            costText = "GRATIS" if zoneInfo["cost"] == 0 else str(zoneInfo["cost"]) + " Adena"
            costTextEn = "FREE" if zoneInfo["cost"] == 0 else str(zoneInfo["cost"]) + " Adena"
            
            html += "<font color=\"LEVEL\">" + zoneInfo["name"] + "</font><br>"
            html += "<font color=\"WHITE\">" + zoneInfo["description"] + "</font><br>"
            html += "<font color=\"YELLOW\">Estado: " + status + " / Status: " + statusEn + "</font><br>"
            html += "<font color=\"GREEN\">Costo: " + costText + " / Cost: " + costTextEn + "</font><br>"
            html += "<button value=\"Entrar a " + zoneInfo["name"] + "\" action=\"bypass -h Quest EpicPvPCompetitive entrar_zona_" + zoneKey + "\" width=200 height=25 back=\"L2UI_ct1.button_df\" fore=\"L2UI_ct1.button_df\"><br><br>"
        
        html += "<font color=\"LEVEL\">üéØ ACCIONES DISPONIBLES / AVAILABLE ACTIONS:</font><br>"
        html += "<button value=\"Ver Ranking Semanal\" action=\"bypass -h Quest EpicPvPCompetitive ver_ranking_semanal\" width=200 height=25 back=\"L2UI_ct1.button_df\" fore=\"L2UI_ct1.button_df\"><br>"
        html += "<button value=\"Ver Mis Estad√≠sticas\" action=\"bypass -h Quest EpicPvPCompetitive ver_mis_estadisticas\" width=200 height=25 back=\"L2UI_ct1.button_df\" fore=\"L2UI_ct1.button_df\"><br>"
        html += "<button value=\"Ver Kill Streaks\" action=\"bypass -h Quest EpicPvPCompetitive ver_kill_streaks\" width=200 height=25 back=\"L2UI_ct1.button_df\" fore=\"L2UI_ct1.button_df\"><br>"
        html += "<button value=\"Ver Recompensas Semanales\" action=\"bypass -h Quest EpicPvPCompetitive ver_recompensas_semanales\" width=200 height=25 back=\"L2UI_ct1.button_df\" fore=\"L2UI_ct1.button_df\"><br>"
        
        html += "<br><font color=\"LEVEL\">üèÜ BENEFICIOS DE PVP COMPETITIVO / COMPETITIVE PVP BENEFITS:</font><br>"
        html += "‚Ä¢ Buffs autom√°ticos al entrar / Automatic buffs when entering<br>"
        html += "‚Ä¢ Sin penalizaci√≥n por muerte / No death penalty<br>"
        html += "‚Ä¢ Recompensas por kills / Rewards for kills<br>"
        html += "‚Ä¢ Kill streaks √©picos / Epic kill streaks<br>"
        html += "‚Ä¢ Ranking semanal / Weekly ranking<br>"
        html += "‚Ä¢ Recompensas semanales / Weekly rewards<br>"
        
        html += "<br><font color=\"LEVEL\">üí∞ MONETIZACI√ìN / MONETIZATION:</font><br>"
        html += "‚Ä¢ Scrolls de resurrecci√≥n / Resurrection scrolls<br>"
        html += "‚Ä¢ T√≠tulos PvP exclusivos / Exclusive PvP titles<br>"
        html += "‚Ä¢ Skins de armas √©picas / Epic weapon skins<br>"
        html += "‚Ä¢ Boosters PvP / PvP boosters<br>"
        html += "‚Ä¢ Cr√©ditos por kills / Credits for kills<br>"
        
        html += "<br><font color=\"LEVEL\">¬°¬°¬° DOMINA EL PVP COMPETITIVO √âPICO !!!</font><br>"
        html += "<font color=\"LEVEL\">¬°¬°¬° DOMINATE THE EPIC COMPETITIVE PVP !!!</font><br>"
        
        html += "</body></html>"
        
        reply = NpcHtmlMessage(1)
        reply.setHtml(html)
        player.sendPacket(reply)
        return None
    
    def entrarZonaPvP(self, player, zoneKey):
        if zoneKey not in self.pvpZones:
            return "Zona PvP no encontrada."
        
        zoneInfo = self.pvpZones[zoneKey]
        
        if not zoneInfo["active"]:
            return "La zona PvP est√° inactiva."
        
        # Verificar costo
        if zoneInfo["cost"] > 0:
            if player.getAdena() < zoneInfo["cost"]:
                return "No tienes suficiente Adena. Necesitas: " + str(zoneInfo["cost"])
            
            # Cobrar costo
            player.reduceAdena("PvPZone", zoneInfo["cost"])
        
        # Teleportar a la zona PvP
        x, y, z = zoneInfo["location"]
        player.teleToLocation(x, y, z)
        
        # Activar PvP flag autom√°tico
        player.setPvpFlag(1)
        
        # Dar buffs √©picos autom√°ticos
        self.darBuffsEpicos(player)
        
        # Inicializar estad√≠sticas si no existen
        if player.getName() not in self.playerStats:
            self.playerStats[player.getName()] = {
                "kills": 0,
                "deaths": 0,
                "killStreak": 0,
                "bestStreak": 0,
                "credits": 0
            }
        
        # Mensaje √©pico
        player.sendMessage("¬°¬°¬° BIENVENIDO AL " + zoneInfo["name"].upper() + " !!!")
        player.sendMessage("¬°¬°¬° WELCOME TO THE " + zoneInfo["name"].upper() + " !!!")
        player.sendMessage("¬°PvP flag activado! ¬°Combate √©pico iniciado!")
        player.sendMessage("PvP flag activated! Epic combat started!")
        
        # Anuncio √©pico
        self.announceToAll(player.getName() + " ha entrado al " + zoneInfo["name"] + "!")
        self.announceToAll(player.getName() + " has entered the " + zoneInfo["name"] + "!")
        
        return "¬°Bienvenido al " + zoneInfo["name"] + "!"
    
    def darBuffsEpicos(self, player):
        # Buffs √©picos para PvP
        epicBuffs = [1085, 1086, 1087, 1044, 1045, 1047, 1048, 1049, 1059, 1062]
        for buffId in epicBuffs:
            player.addSkill(buffId, 3)
        
        player.sendMessage("¬°Has recibido buffs √©picos para PvP!")
        player.sendMessage("You have received epic buffs for PvP!")
    
    def verRankingSemanal(self, player):
        html = "<html><body>"
        html += "<center><font color=\"LEVEL\">¬°¬°¬° RANKING SEMANAL PVP √âPICO !!!</font></center><br>"
        html += "<center><font color=\"LEVEL\">¬°¬°¬° EPIC WEEKLY PVP RANKING !!!</font></center><br><br>"
        
        html += "<font color=\"LEVEL\">üèÜ TOP 20 PVP KILLERS / TOP 20 PVP KILLERS:</font><br><br>"
        
        # Simular ranking semanal (en un servidor real, esto vendr√≠a de la base de datos)
        topPlayers = self.generarRankingPvPSimulado()
        
        for i, playerInfo in enumerate(topPlayers, 1):
            medal = "ü•á" if i == 1 else "ü•à" if i == 2 else "ü•â" if i == 3 else "üèÖ"
            html += "<font color=\"LEVEL\">" + medal + " #" + str(i) + " " + playerInfo["name"] + "</font><br>"
            html += "<font color=\"WHITE\">Kills: " + str(playerInfo["kills"]) + " | Deaths: " + str(playerInfo["deaths"]) + " | Streak: " + str(playerInfo["streak"]) + "</font><br>"
            html += "<font color=\"WHITE\">Kills: " + str(playerInfo["kills"]) + " | Deaths: " + str(playerInfo["deaths"]) + " | Streak: " + str(playerInfo["streak"]) + "</font><br><br>"
        
        html += "<font color=\"LEVEL\">üí∞ RECOMPENSAS SEMANALES / WEEKLY REWARDS:</font><br>"
        html += "‚Ä¢ Top 1: 100,000 Cr√©ditos + T√≠tulo \"Rey del PvP\"<br>"
        html += "‚Ä¢ Top 2: 75,000 Cr√©ditos + T√≠tulo \"Pr√≠ncipe del PvP\"<br>"
        html += "‚Ä¢ Top 3: 50,000 Cr√©ditos + T√≠tulo \"Duque del PvP\"<br>"
        html += "‚Ä¢ Top 5: 25,000 Cr√©ditos + T√≠tulo \"Caballero del PvP\"<br>"
        html += "‚Ä¢ Top 10: 10,000 Cr√©ditos + T√≠tulo \"Guerrero del PvP\"<br>"
        
        html += "<br><font color=\"LEVEL\">üîÑ RESET SEMANAL / WEEKLY RESET:</font><br>"
        html += "‚Ä¢ Cada domingo a las 00:00 / Every Sunday at 00:00<br>"
        html += "‚Ä¢ Recompensas autom√°ticas / Automatic rewards<br>"
        html += "‚Ä¢ Ranking se reinicia / Ranking resets<br>"
        
        html += "<br><font color=\"LEVEL\">¬°¬°¬° COMPITE POR EL PRIMER LUGAR √âPICO !!!</font><br>"
        html += "<font color=\"LEVEL\">¬°¬°¬° COMPETE FOR THE EPIC FIRST PLACE !!!</font><br>"
        
        html += "</body></html>"
        
        reply = NpcHtmlMessage(1)
        reply.setHtml(html)
        player.sendPacket(reply)
        return None
    
    def verMisEstadisticas(self, player):
        playerName = player.getName()
        stats = self.playerStats.get(playerName, {
            "kills": 0,
            "deaths": 0,
            "killStreak": 0,
            "bestStreak": 0,
            "credits": 0
        })
        
        html = "<html><body>"
        html += "<center><font color=\"LEVEL\">¬°¬°¬° MIS ESTAD√çSTICAS PVP √âPICAS !!!</font></center><br>"
        html += "<center><font color=\"LEVEL\">¬°¬°¬° MY EPIC PVP STATISTICS !!!</font></center><br><br>"
        
        html += "<font color=\"LEVEL\">üìä ESTAD√çSTICAS PERSONALES / PERSONAL STATISTICS:</font><br><br>"
        html += "‚Ä¢ Kills totales: " + str(stats["kills"]) + " / Total kills: " + str(stats["kills"]) + "<br>"
        html += "‚Ä¢ Muertes totales: " + str(stats["deaths"]) + " / Total deaths: " + str(stats["deaths"]) + "<br>"
        html += "‚Ä¢ Kill streak actual: " + str(stats["killStreak"]) + " / Current kill streak: " + str(stats["killStreak"]) + "<br>"
        html += "‚Ä¢ Mejor kill streak: " + str(stats["bestStreak"]) + " / Best kill streak: " + str(stats["bestStreak"]) + "<br>"
        html += "‚Ä¢ Cr√©ditos ganados: " + str(stats["credits"]) + " / Credits earned: " + str(stats["credits"]) + "<br>"
        
        # Calcular ratio
        ratio = stats["kills"] / max(1, stats["deaths"])
        html += "‚Ä¢ Ratio K/D: " + str(round(ratio, 2)) + " / K/D Ratio: " + str(round(ratio, 2)) + "<br>"
        
        html += "<br><font color=\"LEVEL\">üéØ LOGROS DESBLOQUEADOS / UNLOCKED ACHIEVEMENTS:</font><br>"
        
        # Verificar logros
        if stats["kills"] >= 100:
            html += "‚Ä¢ ‚úÖ Asesino √âpico (100+ kills) / Epic Killer (100+ kills)<br>"
        if stats["kills"] >= 500:
            html += "‚Ä¢ ‚úÖ Maestro del PvP (500+ kills) / PvP Master (500+ kills)<br>"
        if stats["kills"] >= 1000:
            html += "‚Ä¢ ‚úÖ Leyenda del PvP (1000+ kills) / PvP Legend (1000+ kills)<br>"
        if stats["bestStreak"] >= 10:
            html += "‚Ä¢ ‚úÖ Kill Streak Master (10+ streak) / Kill Streak Master (10+ streak)<br>"
        if stats["bestStreak"] >= 25:
            html += "‚Ä¢ ‚úÖ Kill Streak Legend (25+ streak) / Kill Streak Legend (25+ streak)<br>"
        
        html += "<br><font color=\"LEVEL\">üèÜ POSICI√ìN EN RANKING / RANKING POSITION:</font><br>"
        position = self.calcularPosicionRanking(playerName)
        html += "‚Ä¢ Posici√≥n actual: #" + str(position) + " / Current position: #" + str(position) + "<br>"
        
        html += "<br><font color=\"LEVEL\">¬°¬°¬° SIGUE COMBATIENDO PARA MEJORAR TUS ESTAD√çSTICAS !!!</font><br>"
        html += "<font color=\"LEVEL\">¬°¬°¬° KEEP FIGHTING TO IMPROVE YOUR STATISTICS !!!</font><br>"
        
        html += "</body></html>"
        
        reply = NpcHtmlMessage(1)
        reply.setHtml(html)
        player.sendPacket(reply)
        return None
    
    def verKillStreaks(self, player):
        html = "<html><body>"
        html += "<center><font color=\"LEVEL\">¬°¬°¬° KILL STREAKS √âPICOS !!!</font></center><br>"
        html += "<center><font color=\"LEVEL\">¬°¬°¬° EPIC KILL STREAKS !!!</font></center><br><br>"
        
        html += "<font color=\"LEVEL\">üî• KILL STREAKS DISPONIBLES / AVAILABLE KILL STREAKS:</font><br><br>"
        
        for streak, info in self.killStreaks.items():
            html += "<font color=\"LEVEL\">" + str(streak) + " Kills - " + info["name"] + "</font><br>"
            html += "<font color=\"WHITE\">Recompensa: " + str(info["reward"]) + " Cr√©ditos / Reward: " + str(info["reward"]) + " Credits</font><br>"
            if info["announce"]:
                html += "<font color=\"YELLOW\">‚úÖ Anuncio global / Global announcement</font><br>"
            html += "<br>"
        
        html += "<font color=\"LEVEL\">üí∞ C√ìMO FUNCIONAN / HOW THEY WORK:</font><br>"
        html += "‚Ä¢ Mata jugadores consecutivamente / Kill players consecutively<br>"
        html += "‚Ä¢ Sin morir entre kills / Without dying between kills<br>"
        html += "‚Ä¢ Recompensas autom√°ticas / Automatic rewards<br>"
        html += "‚Ä¢ Anuncios √©picos / Epic announcements<br>"
        html += "‚Ä¢ Cr√©ditos instant√°neos / Instant credits<br>"
        
        html += "<br><font color=\"LEVEL\">üéØ CONSEJOS PARA KILL STREAKS / KILL STREAK TIPS:</font><br>"
        html += "‚Ä¢ Usa buffs √©picos / Use epic buffs<br>"
        html += "‚Ä¢ Combate en grupo / Fight in groups<br>"
        html += "‚Ä¢ Conoce las zonas PvP / Know the PvP zones<br>"
        html += "‚Ä¢ Usa items de resurrecci√≥n / Use resurrection items<br>"
        
        html += "<br><font color=\"LEVEL\">¬°¬°¬° ALCANZA KILL STREAKS √âPICOS !!!</font><br>"
        html += "<font color=\"LEVEL\">¬°¬°¬° ACHIEVE EPIC KILL STREAKS !!!</font><br>"
        
        html += "</body></html>"
        
        reply = NpcHtmlMessage(1)
        reply.setHtml(html)
        player.sendPacket(reply)
        return None
    
    def verRecompensasSemanales(self, player):
        html = "<html><body>"
        html += "<center><font color=\"LEVEL\">¬°¬°¬° RECOMPENSAS SEMANALES PVP √âPICAS !!!</font></center><br>"
        html += "<center><font color=\"LEVEL\">¬°¬°¬° EPIC WEEKLY PVP REWARDS !!!</font></center><br><br>"
        
        html += "<font color=\"LEVEL\">üèÜ RECOMPENSAS POR POSICI√ìN / POSITION REWARDS:</font><br><br>"
        html += "‚Ä¢ ü•á Top 1: 100,000 Cr√©ditos + T√≠tulo \"Rey del PvP\" + Skin √©pica<br>"
        html += "‚Ä¢ ü•à Top 2: 75,000 Cr√©ditos + T√≠tulo \"Pr√≠ncipe del PvP\" + Skin √©pica<br>"
        html += "‚Ä¢ ü•â Top 3: 50,000 Cr√©ditos + T√≠tulo \"Duque del PvP\" + Skin √©pica<br>"
        html += "‚Ä¢ üèÖ Top 5: 25,000 Cr√©ditos + T√≠tulo \"Caballero del PvP\"<br>"
        html += "‚Ä¢ üèÖ Top 10: 10,000 Cr√©ditos + T√≠tulo \"Guerrero del PvP\"<br>"
        html += "‚Ä¢ üèÖ Top 20: 5,000 Cr√©ditos + T√≠tulo \"Soldado del PvP\"<br>"
        html += "‚Ä¢ üèÖ Top 50: 2,500 Cr√©ditos + T√≠tulo \"Novato del PvP\"<br>"
        
        html += "<br><font color=\"LEVEL\">üí∞ RECOMPENSAS POR KILL STREAKS / KILL STREAK REWARDS:</font><br>"
        html += "‚Ä¢ 5 Kills: 1,000 Cr√©ditos + Anuncio global<br>"
        html += "‚Ä¢ 10 Kills: 2,500 Cr√©ditos + Anuncio global<br>"
        html += "‚Ä¢ 15 Kills: 5,000 Cr√©ditos + Anuncio global<br>"
        html += "‚Ä¢ 20 Kills: 10,000 Cr√©ditos + Anuncio global<br>"
        html += "‚Ä¢ 25 Kills: 25,000 Cr√©ditos + Anuncio global<br>"
        html += "‚Ä¢ 30 Kills: 50,000 Cr√©ditos + Anuncio global<br>"
        
        html += "<br><font color=\"LEVEL\">üéÅ RECOMPENSAS ESPECIALES / SPECIAL REWARDS:</font><br>"
        html += "‚Ä¢ MVP del d√≠a: 5,000 Cr√©ditos + T√≠tulo \"MVP del D√≠a\"<br>"
        html += "‚Ä¢ M√°s kills en 1 hora: 10,000 Cr√©ditos + T√≠tulo \"Rey de la Hora\"<br>"
        html += "‚Ä¢ Mejor ratio K/D: 15,000 Cr√©ditos + T√≠tulo \"Precisi√≥n √âpica\"<br>"
        html += "‚Ä¢ M√°s participaciones: 8,000 Cr√©ditos + T√≠tulo \"Guerrero Incansable\"<br>"
        
        html += "<br><font color=\"LEVEL\">üîÑ SISTEMA DE ENTREGA / DELIVERY SYSTEM:</font><br>"
        html += "‚Ä¢ Recompensas autom√°ticas / Automatic rewards<br>"
        html += "‚Ä¢ Entrega cada domingo / Delivery every Sunday<br>"
        html += "‚Ä¢ Cr√©ditos instant√°neos / Instant credits<br>"
        html += "‚Ä¢ T√≠tulos autom√°ticos / Automatic titles<br>"
        html += "‚Ä¢ Skins autom√°ticas / Automatic skins<br>"
        
        html += "<br><font color=\"LEVEL\">¬°¬°¬° COMPITE POR LAS MEJORES RECOMPENSAS √âPICAS !!!</font><br>"
        html += "<font color=\"LEVEL\">¬°¬°¬° COMPETE FOR THE BEST EPIC REWARDS !!!</font><br>"
        
        html += "</body></html>"
        
        reply = NpcHtmlMessage(1)
        reply.setHtml(html)
        player.sendPacket(reply)
        return None
    
    def generarRankingPvPSimulado(self):
        # Simular ranking PvP (en un servidor real, esto vendr√≠a de la base de datos)
        players = []
        for i in range(20):
            players.append({
                "name": "EpicPvP" + str(i+1),
                "kills": 1000 - i * 50,
                "deaths": 100 + i * 10,
                "streak": 30 - i
            })
        return players
    
    def calcularPosicionRanking(self, playerName):
        # Simular posici√≥n (en un servidor real, esto se calcular√≠a de la base de datos)
        return 25  # Posici√≥n promedio
    
    def onKill(self, npc, player, isPet):
        if isinstance(npc, L2PcInstance) and isinstance(player, L2PcInstance):
            # Verificar si ambos est√°n en zona PvP
            if self.estaEnZonaPvP(player) and self.estaEnZonaPvP(npc):
                self.procesarKillPvP(player, npc)
        return None
    
    def estaEnZonaPvP(self, player):
        # Verificar si el jugador est√° en alguna zona PvP
        for zoneInfo in self.pvpZones.values():
            x, y, z = zoneInfo["location"]
            if abs(player.getX() - x) < 1000 and abs(player.getY() - y) < 1000:
                return True
        return False
    
    def procesarKillPvP(self, killer, victim):
        killerName = killer.getName()
        victimName = victim.getName()
        
        # Inicializar estad√≠sticas si no existen
        if killerName not in self.playerStats:
            self.playerStats[killerName] = {
                "kills": 0,
                "deaths": 0,
                "killStreak": 0,
                "bestStreak": 0,
                "credits": 0
            }
        
        if victimName not in self.playerStats:
            self.playerStats[victimName] = {
                "kills": 0,
                "deaths": 0,
                "killStreak": 0,
                "bestStreak": 0,
                "credits": 0
            }
        
        # Actualizar estad√≠sticas del killer
        self.playerStats[killerName]["kills"] += 1
        self.playerStats[killerName]["killStreak"] += 1
        
        # Actualizar mejor streak
        if self.playerStats[killerName]["killStreak"] > self.playerStats[killerName]["bestStreak"]:
            self.playerStats[killerName]["bestStreak"] = self.playerStats[killerName]["killStreak"]
        
        # Actualizar estad√≠sticas de la v√≠ctima
        self.playerStats[victimName]["deaths"] += 1
        self.playerStats[victimName]["killStreak"] = 0
        
        # Verificar kill streaks
        currentStreak = self.playerStats[killerName]["killStreak"]
        if currentStreak in self.killStreaks:
            streakInfo = self.killStreaks[currentStreak]
            
            # Dar recompensa
            self.playerStats[killerName]["credits"] += streakInfo["reward"]
            
            # Anuncio √©pico
            if streakInfo["announce"]:
                self.announceToAll("¬°¬°¬° " + killerName + " ALCANZ√ì " + streakInfo["name"] + " (" + str(currentStreak) + " KILLS) !!!")
                self.announceToAll("¬°¬°¬° " + killerName + " ACHIEVED " + streakInfo["name"] + " (" + str(currentStreak") + " KILLS) !!!")
                self.announceToAll("¬°¬°¬° RECOMPENSA: " + str(streakInfo["reward"]) + " CR√âDITOS !!!")
                self.announceToAll("¬°¬°¬° REWARD: " + str(streakInfo["reward"]) + " CREDITS !!!")
            
            # Mensaje al killer
            killer.sendMessage("¬°¬°¬° " + streakInfo["name"] + " ALCANZADO !!!")
            killer.sendMessage("¬°¬°¬° " + streakInfo["name"] + " ACHIEVED !!!")
            killer.sendMessage("¬°Recompensa: " + str(streakInfo["reward"]) + " Cr√©ditos!")
            killer.sendMessage("Reward: " + str(streakInfo["reward"]) + " Credits!")
        
        # Recompensa b√°sica por kill
        basicReward = 100
        self.playerStats[killerName]["credits"] += basicReward
        
        # Mensaje al killer
        killer.sendMessage("¬°¬°¬° KILL √âPICO !!! +" + str(basicReward) + " Cr√©ditos!")
        killer.sendMessage("¬°¬°¬° EPIC KILL !!! +" + str(basicReward) + " Credits!")
        
        # Anuncio del kill
        self.announceToAll(killerName + " elimin√≥ a " + victimName + " en PvP √âpico!")
        self.announceToAll(killerName + " eliminated " + victimName + " in Epic PvP!")
    
    def announceToAll(self, message):
        from l2jfrozen.gameserver.network.serverpackets import CreatureSay
        from l2jfrozen.gameserver.model.actor.instance import L2PcInstance
        from l2jfrozen.gameserver.GameServer import GameServer
        
        for player in GameServer.getInstance().getAllPlayers():
            if player and player.isOnline():
                player.sendPacket(CreatureSay(0, 1, "PVP COMPETITIVO √âPICO", message))

# Crear instancia del sistema de PvP competitivo √©pico
PVP_COMPETITIVO_EPICO = EpicPvPCompetitive(-1, "PvPCompetitivoEpico", "Sistema de PvP Competitivo √âpico")

# Registrar el sistema
PVP_COMPETITIVO_EPICO.addStartNpc(30006)  # Tienda GM
PVP_COMPETITIVO_EPICO.addTalkId(30006)



